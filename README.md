# åˆ›é«˜ä½“è‚²æ‰“å¡è„šæœ¬

[16çº§ä»¥åçš„è‡ªå–](https://github.com/Letra312/chuanggao-checkIn)ï¼Œæ²¡ç»å†è¿‡ä½“è‚²æ‰“å¡çš„è€äººå°±åˆ«å‡‘çƒ­é—¹äº†:-)

## ä½¿ç”¨æ–¹æ³•

clone ä»“åº“åˆ°æœ¬åœ°ä¹‹åï¼Œå°†config/congig.jsonä¸­çš„XHå€¼æ”¹æˆå­¦å·ï¼Œå°†NAMEå€¼æ”¹æˆå§“å

ç„¶åä¾æ¬¡æ‰§è¡Œå‘½ä»¤

```shell
cd <you-repository> # è¿›å…¥cloneä¸‹æ¥çš„æœ¬åœ°ä»“åº“
npm install # or yarn install
npm generate #ç”Ÿæˆæœ¬åœ° æ‰“å¡æˆå‘˜åˆ—è¡¨
# åç»­æ·»åŠ é”®å…¥ npm input å¯æ·»åŠ æ‰“å¡æˆå‘˜åŠŸèƒ½
# ç„¶ååœ¨config/participants.jsonä¸­æŒ‰ç…§jsonæ ¼å¼æŠŠé”®æ”¹æˆè‡ªå·±åå­—ï¼Œå€¼æ”¹æˆå­¦å·å³å¯
npm start # or yarn start
```

å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œå°±æ€»æ˜¯å¿˜æ‰æ‰“å¡ï¼Œå°±æƒ³æŠŠåˆ›é«˜ä½“è‚²ç»™ç ´äº†ï¼Œè¿™æ ·å­å°±å¯ä»¥ä¸ç”¨è·‘æ­¥ä¹Ÿèƒ½æ‰“å¡å•¦:D **åŒæ—¶æ„Ÿè°¢lytæŠ€æœ¯æ”¯æŒğŸ‘ğŸ‘**

### è·‘æ­¥

æˆ‘ä»¬æ‹¿å‡ºæ‰‹æœºï¼Œæ‰“å¼€ä¸‡æ¶çš„åˆ›é«˜

![AppBeginWithoutGPS](./images/AppBeginWithoutGPS.PNG)

è¿æ°”è¿˜ä¸é”™ï¼Œåˆšå¥½GPSä¿¡å·ä¸å¥½

ç„¶åå¼€å§‹è·‘æ­¥ï¼ˆæ‘‡æ‰‹æœºï¼‰

![AppRunning](./images/AppRunning.PNG)

æ‘‡äº†ä¸€åˆ†é’Ÿï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯è¦æ‘‡ç€æ‰“å¡ï¼Œåªæ˜¯æƒ³è¦å‘æ¬¡è¯·æ±‚è€Œå·²ï¼Œå·®ä¸å¤šäº†

ç»“æŸè·‘æ­¥ï¼Œæ‰“ç®—æäº¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„ä½ç½®å¹¶æœªç§»åŠ¨ï¼Œè¿˜æ˜¯è·‘äº†0.25å…¬é‡Œ

![AppFinishRunning](./images/AppFinishRunning.PNG)

### æŠ“åŒ…

é‚£ä¹ˆä»–åˆ°åº•å‘é€äº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æŠ“åŒ…ä¸‹æ¥çœ‹ä¸€ä¸‹

![catchTheRequest1](./images/catchTheRequest1.png)

![catchTheRequestHeader](./images/catchTheRequestHeader.png)

å¯ä»¥çœ‹åˆ°è¿headerséƒ½æå…¶éšæ„ï¼Œç”šè‡³è¿cookieéƒ½æ²¡æœ‰ï¼é¡¿æ—¶ä¿¡å¿ƒæ»¡æ»¡

ç„¶åå†çœ‹çœ‹è¯¦ç»†çš„æ•°æ®ï¼Œé‚£ä¸ªjsonsportsä¸å°±æ˜¯ä¸€ä¸ªurlencodeå—ï¼Œsignæ˜¯ä¸ªç­¾åï¼Œtimestampæ˜¯ä¸ªæ—¶é—´æˆ³ï¼ˆå¤šæ¬¡æµ‹è¯•å‡ºapp_keyæ•°æ®æ˜¯ä¸å˜çš„ï¼‰ï¼Œå¥½åƒä¹Ÿå¾ˆç®€å•å‘¢ï¼Œå°±æƒ³å¿«ç‚¹æŠŠä»–æå®šäº†

![catchTheRequest2](./images/catchTheRequest2.png)

url decode ä¹‹åçš„jsonSportsæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

``` json
{
    "xh": "U2016XXXXX",
    "sportId": "1525968995054",
    "currentDate": "2018-05-11 00:16:35",
    "calorie": "12.8",
    "odometer": "0.20",
    "avgSpeed": "12.6",
    "activeTime": "00:00:55",
    "mood": "0",
    "saySome": "",
    "beganPoint": "30.514429|114.434174",
    "endPoint": "30.514429|114.434174",
    "isValid": "1",
    "planRouteName": "è·‘æ­¥",
    "modementMode": "3",
    "routePolylineBh": "",
    "endTime": "2018-05-11 00:17:31",
    "beginTime": "2018-05-11 00:16:35",
    "routeId": "7",
    "phoneVersion": "iPhone8.2,11.2,B6E3A84E-B928-4720-A6F9-A1390B3ED6BD|3.4.2",
    "alreadyPassPoint": "",
    "name": "XXX",
    "stepCount": "0",
    "isValidReason": "",
    "coordinate": [{
        "a": "30.514084",
        "v": "1",
        "o": "114.434258",
        "s": "1526222274"
        }, {
        "a": "30.514027",
        "v": "-1",
        "o": "114.434265",
        "s": "1526222278"
        }, {
        "a": "30.513941",
        "v": "-1",
        "o": "114.434265",
        "s": "1526222281"
        }, {
        "a": "30.513897",
        "v": "-1",
        "o": "114.434265",
        "s": "1526222284"
        }, {
        "a": "30.513884",
        "v": "-1",
        "o": "114.434265",
        "s": "1526222287"
        }, {
        "a": "30.513874",
        "v": "-1",
        "o": "114.434250",
        "s": "1526222289"
        }, {
        "a": "30.513861",
        "v": "-1",
        "o": "114.434227",
        "s": "1526222292"
        }, {
        "a": "30.513844",
        "v": "-1",
        "o": "114.434204",
        "s": "1526222296"
        }, {
        "a": "30.513828",
        "v": "-1",
        "o": "114.434158",
        "s": "1526222299"
        }]
}
```

å¥½åƒæ•°æ®ç»“æ„ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä½†æ˜¯é‚£ä¸ªsignæ˜¯æ€ä¹ˆè·å–çš„å‘¢ï¼Ÿ

è¦çŸ¥é“æ€ä¹ˆè·å–è‚¯å®šéœ€è¦åç¼–è¯‘å‡ºæºä»£ç å‘€...

å¥½å§ï¼Œå¯¹åŠ å¯†ç®—æ³•ä¸€çªä¸é€šåˆä¸ä¼šå®‰å“çš„æˆ‘è¿˜æ˜¯å»æ±‚åŠ©å§...

ç¬¬ä¸€æ¬¡è·Ÿlytè¯´äº†è¿™ä¸ªç©æ„â€¦å®‰å“å¥½åƒå†™çš„è¿˜è›®å¤æ‚ï¼Œæäº†ä¸€ä¼šâ€¦æä¸å®š...

äºæ˜¯å°±é¸½äº†ä¸‰å‘¨ï¼Œå‰ä¸ä¹…ç»ˆäºæå‡ºsignçš„åŠ å¯†æ–¹å¼äº†...

æ€è·¯å¦‚ä¸‹ï¼š

```javascript
const app_secret = '6d3121b650e42855976d0f70dd2048e4'; // è¿™æ˜¯ä¸€ä¸ªé™æ€çš„å­—ç¬¦ä¸²ï¼Œä¸çŸ¥é“æ€ä¹ˆè·å–çš„ï¼Œä¹Ÿè®¸æ˜¯å¼€å‘è€…å¥³æœ‹å‹çš„ç”Ÿæ—¥hashå‡ºæ¥çš„å§hhh

function getSign(mapList, apiString, timestamp) {
  let toBeEncodedStr; // è¦è¢«åŠ å¯†çš„å­—ç¬¦ä¸²
  let mapListStr = getmapListStr(mapList); // ç”±jsonsportsé”®å€¼æ‹¼æ¥å‡ºæ¥çš„å­—ç¬¦ä¸²
  toBeEncodedStr =`${app_secret}${apiString}${mapListStr}${timestamp} ${app_secret}`; //å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ° è¢«åŠ å¯†çš„å­—ç¬¦ä¸²æ„æˆï¼Œå³ï¼š app_secret + apiString('/api/v3/savesports') + é”®å€¼å­—ç¬¦ä¸² + ''(ç©ºæ ¼) + app_secret
  return md5Crypto(toBeEncodedStr); // é‡‡ç”¨çš„æ˜¯md5åŠ å¯†çš„æ–¹å¼
}
```

è¿™æ ·å°±ç®€å•äº†ï¼Œè¿˜æœ‰ä¸€äº›å°å°ç»†èŠ‚çš„å¤„ç†æ–¹å¼ï¼Œé‚£äº›æœ‰ç–‘æƒ‘çš„éœ€è¦éƒ½å¯ä»¥åœ¨æºç é‡Œé¢è§£å†³å•¦~

## TODO

- æ„å»ºæ‰“å¡UI

- åŠ å…¥æµ‹è¯•
- æé«˜æœ¬äº§å“ç”¨æˆ·ä½“éªŒ
- ...

æŒç»­æ›´æ–°...